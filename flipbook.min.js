!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var e,n,o,i,r,a,f,s,u,c,d,l,h,p,m,g,v,w,x,y={},M=-1,b=function(){window.requestAnimatoinFrame=G(),x=J();var t=A();t?K("invalid options, missing "+t):(O(),B(),I(),E(function(t){t?K(t):k()}))},A=function(){var e,n;return n=t.sprite?["id","path","extension","filename","rows"]:["id","path","extension","filename","count"],n.forEach(function(n){t[n]||(e=n)}),e},O=function(){t.speed=isNaN(t.speed)?.5:Math.min(Math.max(0,parseFloat(t.speed)),1),t.sprite?t.count=t.rows.reduce(function(t,e){return t+e}):t.count=parseInt(t.count),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/")},k=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),v=!0,P(),Y(),N(0),x&&W()},B=function(){e=document.getElementById(t.id),e.classList.add("flipbook-container"),n=document.createElement("div"),n.classList.add("flipbook-graphic"),e.appendChild(n),o=C(n),i=o.getContext("2d")},I=function(){T(e,{position:"relative",width:"100%",overflow:"hidden"}),T(n,{position:"absolute",top:0,left:0}),T(o,{position:"absolute",top:0,left:0})},Y=function(){window.addEventListener("resize",P,!1),x||window.addEventListener("scroll",S,!1)},E=function(e){var n=t.sprite?t.rows.length:n=t.count;m=L(n),g=[],F(0,n,e)},F=function(t,e,n){var o=m[t];D(o,function(i,r){if(i)n("error loading image");else{o.img=r,0===t&&q(r,o.rows);for(var a=0;a<o.rows;a++)g.push({imageIndex:t,x:0,y:a});H(t,e),t++,t<m.length?F(t,e,n):n()}})},q=function(t,e){l=t.naturalWidth,h=t.naturalHeight/e,p=Math.round(l/h*1e3)/1e3},H=function(e,n){t.progress&&"function"==typeof t.progress&&t.progress({frame:e+1,total:t.count,percent:Math.round(e/(n-1)*100)})},L=function(e){for(var n=[],o=0;e>o;o++){var i=R(o+1);n[o]={src:i,rows:t.sprite?t.rows[o]:1}}return n},R=function(e){for(var n=t.filename.match(/\%\dd/),o=n[0].charAt(1),i=e.toString().length,r=Math.max(o-i,0),a=t.filename.split(/\%\dd/)[0],f=t.path+a,s=0;r>s;s++)f+="0";return f+=e+"."+t.extension},C=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},W=function(){var e=g.length,n=0,o=500,i=function(){N(n),n++,n>=e&&(n=0),setTimeout(i,o-t.speed*o*.9)};i()},P=function(){if(r=e.offsetWidth,t.cover){a=innerHeight;var i=r/a;p>i?(y.width=Math.floor(i*h),y.height=h,y.offsetX=Math.floor((l-y.width)/2),y.offsetY=0):(y.height=Math.floor(l/i),y.width=l,y.offsetX=0,y.offsetY=Math.floor((h-y.height)/2))}else a=Math.floor(r/p);var m;m=x?20:innerHeight-a,s=a+m,o.width=r,o.height=a,o.style.top=Math.floor(m/2)+"px",n.style.height=s+"px",n.style.width=r+"px";var g=j();f=x?s:innerHeight*g,e.style.height=f+"px";var v=e.getBoundingClientRect();u=v.left,c=v.top+pageYOffset,d=v.bottom+pageYOffset-n.offsetHeight,x||(X(),z(pageYOffset-c,!0))},S=function(){w||requestAnimationFrame(X),w=!0},X=function(){if(w=!1,v){var t=pageYOffset-c,e=pageYOffset-d;t>0&&0>e?(T(n,{position:"fixed",top:0,left:u+"px",bottom:"auto"}),z(t)):e>0?(T(n,{position:"absolute",top:"auto",left:0,bottom:0}),z(f)):0>t&&(T(n,{position:"absolute",top:0,left:0,bottom:"auto"}),z(0))}},z=function(e,n){var o=e/(f-s);o=Math.min(Math.max(o,0),1);var i=Math.floor(o*(t.count-1));(n||M!==i)&&(M=i,N(i))},N=function(e){i.clearRect(0,0,r,a);var n,o,f,s,u=g[e],c=m[u.imageIndex];t.cover?(n=y.offsetX,o=y.offsetY+h*u.y,f=y.width,s=y.height):(n=0,o=h*u.y,f=l,s=h),i.drawImage(c.img,n,o,f,s,0,0,r,a)},T=function(t,e){for(var n in e)t.style[n]=e[n]},j=function(){var e=10,n=2;return n+e*(1-t.speed)},D=function(t,e){var n=new Image;n.onload=function(){e(null,n)},n.onerror=function(){e("error loading image: "+t.src)},n.src=t.src},G=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}},J=function(){var t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()}};return t.any()},K=function(t){console&&console.error&&console.error("::flipbook:: "+t)};b()};return t});