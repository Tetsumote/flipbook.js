!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var n,e,o,i,r,a,f,s,u,c,d,l,p,h,g,m,v,w,x,y={},b=-1,M=function(){window.requestAnimatoinFrame=D(),x=G();var t=A();t?J("invalid options, missing "+t):(O(),B(),I(),E(function(t){t?J(J):k()}))},A=function(){var n,e;return e=t.sprite?["id","path","extension","rows"]:["id","path","extension","count"],e.forEach(function(e){t[e]||(n=e)}),n},O=function(){t.speed=isNaN(t.speed)?.5:Math.min(Math.max(0,parseFloat(t.speed)),1),t.sprite?t.count=t.rows.reduce(function(t,n){return t+n}):t.count=parseInt(t.count),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/")},k=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),v=!0,W(),Y(),N(0),x&&C()},B=function(){n=document.getElementById(t.id),n.classList.add("flipbook-container"),e=document.createElement("div"),e.classList.add("flipbook-graphic"),n.appendChild(e),o=R(e),i=o.getContext("2d")},I=function(){S(n,{position:"relative",width:"100%",overflow:"hidden"}),S(e,{position:"absolute",top:0,left:0}),S(o,{position:"absolute",top:0,left:0})},Y=function(){window.addEventListener("resize",W,!1),x||window.addEventListener("scroll",P,!1)},E=function(n){var e=t.sprite?t.rows.length:e=t.count;g=L(e),m=[],F(0,e,n)},F=function(t,n,e){var o=g[t];j(o,function(i,r){if(i)e("error loading image");else{o.img=r,0===t&&q(r,o.rows);for(var a=0;a<o.rows;a++)m.push({imageIndex:t,x:0,y:a});H(t,n),t++,t<g.length?F(t,n,e):e()}})},q=function(t,n){l=t.naturalWidth,p=t.naturalHeight/n,h=Math.round(l/p*1e3)/1e3},H=function(n,e){t.progress&&"function"==typeof t.progress&&t.progress({frame:n+1,total:t.count,percent:Math.round(n/(e-1)*100)})},L=function(n){for(var e=[],o=0;n>o;o++)e[o]={src:t.path+(o+1)+"."+t.extension,rows:t.sprite?t.rows[o]:1};return e},R=function(t){var n=document.createElement("canvas");return n.classList.add("flipbook-canvas"),t.appendChild(n),n},C=function(){var n=m.length,e=0,o=500,i=function(){N(e),e++,e>=n&&(e=0),setTimeout(i,o-t.speed*o*.9)};i()},W=function(){if(r=n.offsetWidth,t.cover){a=innerHeight;var i=r/a;h>i?(y.width=Math.floor(i*p),y.height=p,y.offsetX=Math.floor((l-y.width)/2),y.offsetY=0):(y.height=Math.floor(l/i),y.width=l,y.offsetX=0,y.offsetY=Math.floor((p-y.height)/2))}else a=Math.floor(r/h);var g;g=x?20:innerHeight-a,s=a+g,o.width=r,o.height=a,o.style.top=Math.floor(g/2)+"px",e.style.height=s+"px",e.style.width=r+"px";var m=T();f=x?s:innerHeight*m,n.style.height=f+"px";var v=n.getBoundingClientRect();u=v.left,c=v.top+pageYOffset,d=v.bottom+pageYOffset-e.offsetHeight,x||(X(),z(pageYOffset-c,!0))},P=function(){w||requestAnimationFrame(X),w=!0},X=function(){if(w=!1,v){var t=pageYOffset-c,n=pageYOffset-d;t>0&&0>n?(S(e,{position:"fixed",top:0,left:u+"px",bottom:"auto"}),z(t)):n>0?(S(e,{position:"absolute",top:"auto",left:0,bottom:0}),z(f)):0>t&&(S(e,{position:"absolute",top:0,left:0,bottom:"auto"}),z(0))}},z=function(n,e){var o=n/(f-s);o=Math.min(Math.max(o,0),1);var i=Math.floor(o*(t.count-1));(e||b!==i)&&(b=i,N(i))},N=function(n){i.clearRect(0,0,r,a);var e,o,f,s,u=m[n],c=g[u.imageIndex];t.cover?(e=y.offsetX,o=y.offsetY+p*u.y,f=y.width,s=y.height):(e=0,o=p*u.y,f=l,s=p),i.drawImage(c.img,e,o,f,s,0,0,r,a)},S=function(t,n){for(var e in n)t.style[e]=n[e]},T=function(){var n=10,e=2;return e+n*(1-t.speed)},j=function(t,n){var e=new Image;e.onload=function(){n(null,e)},e.onerror=function(){n("error loading image: "+t.src)},e.src=t.src},D=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)}},G=function(){var t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()}};return t.any()},J=function(t){console&&console.error&&console.error("::flipbook:: "+t)};M()};return t});