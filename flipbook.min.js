!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var e,o,n,i,a,r,f,d,s,l,c,p,h,u,m,g,v,b,w,x,M={},k=-1,y=function(){var e,o=["id","path","extension","frames"];o.forEach(function(o){t[o]||(e=o)}),e?T("invalid options, missing "+e):(t.speed=parseFloat(t.speed)||.5,t.frames=parseInt(t.frames),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/"),L(),C(),I(function(t){t?T(T):E()}))},E=function(){b=!0,Y(),H(),R(0),e.removeChild(a)},L=function(){e=document.getElementById(t.id),e.classList.add("flipbook-container"),a=document.createElement("div"),a.classList.add("flipbook-loader"),r=document.createElement("div"),r.classList.add("flipbook-loader--progress"),f=document.createElement("div"),f.classList.add("flipbook-loader--text"),f.innerText="Loading animation...",a.appendChild(r),a.appendChild(f),e.appendChild(a),o=document.createElement("div"),o.classList.add("flipbook-graphic"),e.appendChild(o),n=O(o),i=n.getContext("2d")},C=function(){W(e,{position:"relative",width:"100%",overflow:"hidden"}),W(a,{position:"relative","text-align":"center",padding:"1em","font-family":"sans-serif",color:"#666",background:"#efefef"}),W(r,{position:"absolute","z-index":0,top:0,left:0,width:0,height:"100%",background:"#ddd"}),W(f,{position:"relative"}),W(o,{position:"absolute",top:0,left:0}),W(n,{position:"absolute",top:0,left:0})},Y=function(){window.addEventListener("resize",H,!1),window.addEventListener("scroll",X,!1)},I=function(e){w=[];for(var o=0;o<t.frames;o++)w[o]={src:t.path+(o+1)+"."+t.extension};var n=function(o){var i=w[o];A(i,function(a,f){a?e("error loading image"):(i.img=f,0===o&&(m=f.naturalWidth,g=f.naturalHeight,v=Math.round(m/g*1e3)/1e3),W(r,{width:Math.round(o/(t.frames-1)*100)+"%"}),o++,o<w.length?n(o):e())})};n(0)},O=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},H=function(){if(d=e.offsetWidth,t.cover){s=innerHeight;var i=d/s;v>i?(M.width=Math.floor(i*g),M.height=g,M.offsetX=Math.floor((m-M.width)/2),M.offsetY=0):(M.height=Math.floor(m/i),M.width=m,M.offsetX=0,M.offsetY=Math.floor((g-M.height)/2))}else s=Math.floor(d/v);var a=innerHeight-s;c=s+a,n.width=d,n.height=s,n.style.top=Math.floor(a/2)+"px",o.style.height=c+"px",o.style.width=d+"px";var r=q();l=innerHeight*r,e.style.height=l+"px";var f=e.getBoundingClientRect();p=f.left,h=f.top+pageYOffset,u=f.bottom+pageYOffset-o.offsetHeight,B(),F(pageYOffset-h,!0)},X=function(){z()},z=function(){x||requestAnimationFrame(B),x=!0},B=function(){if(x=!1,b){var t=pageYOffset-h,e=pageYOffset-u;t>0&&0>e?(W(o,{position:"fixed",top:0,left:p+"px",bottom:"auto"}),F(t)):e>0?(W(o,{position:"absolute",top:"auto",left:0,bottom:0}),F(l)):0>t&&(W(o,{position:"absolute",top:0,left:0,bottom:"auto"}),F(0))}},F=function(e,o){var n=e/(l-c);n=Math.min(Math.max(n,0),1);var i=Math.floor(n*(t.frames-1));(o||k!==i)&&(k=i,R(i))},R=function(e){i.clearRect(0,0,d,s),t.cover?i.drawImage(w[e].img,M.offsetX,M.offsetY,M.width,M.height,0,0,d,s):i.drawImage(w[e].img,0,0,d,s)},W=function(t,e){for(var o in e)t.style[o]=e[o]},q=function(){var e=10,o=2;return o+e*(1-t.speed)},A=function(t,e){var o=new Image;o.onload=function(){e(null,o)},o.onerror=function(){e("error loading image: "+t.src)},o.src=t.src},T=function(t){console&&console.error&&console.error("::flipbook:: "+t)};y()};return t});