!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var o,e,n,i,r,a,f,s,c,u,d,l,p,h,g,m,v,w,x={},b=-1,y=function(){var t=M();t?J("invalid options, missing "+t):(Y(),E(),O(),H(function(t){t?J(J):I()}))},M=function(){var o,e;return e=t.sprite?["id","path","extension","rows"]:["id","path","extension","count"],e.forEach(function(e){t[e]||(o=e)}),o},Y=function(){t.speed=isNaN(t.speed)?.5:Math.min(Math.max(0,parseFloat(t.speed)),1),t.sprite?t.count=t.rows.reduce(function(t,o){return t+o}):t.count=parseInt(t.count),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/")},I=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),v=!0,N(),k(),A(0)},E=function(){o=document.getElementById(t.id),o.classList.add("flipbook-container"),e=document.createElement("div"),e.classList.add("flipbook-graphic"),o.appendChild(e),n=F(e),i=n.getContext("2d")},O=function(){j(o,{position:"relative",width:"100%",overflow:"hidden"}),j(e,{position:"absolute",top:0,left:0}),j(n,{position:"absolute",top:0,left:0})},k=function(){window.addEventListener("resize",N,!1),window.addEventListener("scroll",R,!1)},H=function(o){var e=t.sprite?t.rows.length:e=t.count;g=B(e),m=[],L(0,e,o)},L=function(t,o,e){var n=g[t];G(n,function(i,r){if(i)e("error loading image");else{n.img=r,0===t&&C(r,n.rows);for(var a=0;a<n.rows;a++)m.push({imageIndex:t,x:0,y:a});X(t,o),t++,t<g.length?L(t,o,e):e()}})},C=function(t,o){l=t.naturalWidth,p=t.naturalHeight/o,h=Math.round(l/p*1e3)/1e3},X=function(o,e){t.progress&&"function"==typeof t.progress&&t.progress({frame:o+1,total:t.count,percent:Math.round(o/(e-1)*100)})},B=function(o){for(var e=[],n=0;o>n;n++)e[n]={src:t.path+(n+1)+"."+t.extension,rows:t.sprite?t.rows[n]:1};return e},F=function(t){var o=document.createElement("canvas");return o.classList.add("flipbook-canvas"),t.appendChild(o),o},N=function(){if(r=o.offsetWidth,t.cover){a=innerHeight;var i=r/a;h>i?(x.width=Math.floor(i*p),x.height=p,x.offsetX=Math.floor((l-x.width)/2),x.offsetY=0):(x.height=Math.floor(l/i),x.width=l,x.offsetX=0,x.offsetY=Math.floor((p-x.height)/2))}else a=Math.floor(r/h);var g=innerHeight-a;s=a+g,n.width=r,n.height=a,n.style.top=Math.floor(g/2)+"px",e.style.height=s+"px",e.style.width=r+"px";var m=D();f=innerHeight*m,o.style.height=f+"px";var v=o.getBoundingClientRect();c=v.left,u=v.top+pageYOffset,d=v.bottom+pageYOffset-e.offsetHeight,q(),z(pageYOffset-u,!0)},R=function(){W()},W=function(){w||requestAnimationFrame(q),w=!0},q=function(){if(w=!1,v){var t=pageYOffset-u,o=pageYOffset-d;t>0&&0>o?(j(e,{position:"fixed",top:0,left:c+"px",bottom:"auto"}),z(t)):o>0?(j(e,{position:"absolute",top:"auto",left:0,bottom:0}),z(f)):0>t&&(j(e,{position:"absolute",top:0,left:0,bottom:"auto"}),z(0))}},z=function(o,e){var n=o/(f-s);n=Math.min(Math.max(n,0),1);var i=Math.floor(n*(t.count-1));(e||b!==i)&&(b=i,A(i))},A=function(o){i.clearRect(0,0,r,a);var e,n,f,s,c=m[o],u=g[c.imageIndex];t.cover?(e=x.offsetX,n=x.offsetY+p*c.y,f=x.width,s=x.height):(e=0,n=p*c.y,f=l,s=p),i.drawImage(u.img,e,n,f,s,0,0,r,a)},j=function(t,o){for(var e in o)t.style[e]=o[e]},D=function(){var o=10,e=2;return e+o*(1-t.speed)},G=function(t,o){var e=new Image;e.onload=function(){o(null,e)},e.onerror=function(){o("error loading image: "+t.src)},e.src=t.src},J=function(t){console&&console.error&&console.error("::flipbook:: "+t)};y()};return t});