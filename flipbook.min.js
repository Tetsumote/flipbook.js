!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var e,o,n,i,r,a,f,s,c,d,l,u,p,h,g,m,v,w,x={},b=-1,M=function(){var t=y();t?D("invalid options, missing "+t):(Y(),I(),O(),C(function(t){t?D(D):E()}))},y=function(){var e,o;return o=t.sprite?["id","path","extension","rows"]:["id","path","extension","frames"],o.forEach(function(o){t[o]||(e=o)}),e},Y=function(){t.speed=parseFloat(t.speed)||.5,t.sprite?t.count=t.rows.reduce(function(t,e){return t+e}):t.count=parseInt(t.count),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/")},E=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),v=!0,k(),X(),q(0)},I=function(){e=document.getElementById(t.id),e.classList.add("flipbook-container"),o=document.createElement("div"),o.classList.add("flipbook-graphic"),e.appendChild(o),n=L(o),i=n.getContext("2d")},O=function(){z(e,{position:"relative",width:"100%",overflow:"hidden"}),z(o,{position:"absolute",top:0,left:0}),z(n,{position:"absolute",top:0,left:0})},k=function(){window.addEventListener("resize",X,!1),window.addEventListener("scroll",B,!1)},C=function(e){r=document.createElement("canvas"),a=r.getContext("2d");var o=t.sprite?t.rows.length:o=t.count,n=H(o),i=0,f=function(s){var c=n[s];j(c,function(d,l){if(d)e("error loading image");else{c.img=l,0===s&&(h=l.naturalWidth,g=l.naturalHeight/c.rows,m=Math.round(h/g*1e3)/1e3,r.width=h,r.height=g*t.count);for(var u=0;u<c.rows;u++)a.drawImage(c.img,0,u*g,h,g,0,g*i,h,g),i++;t.progress&&"function"==typeof t.progress&&t.progress({frame:s+1,total:t.count,percent:Math.round(s/(o-1)*100)}),s++,s<n.length?f(s):e()}})};f(0)},H=function(e){for(var o=[],n=0;e>n;n++)o[n]={src:t.path+(n+1)+"."+t.extension,rows:t.sprite?t.rows[n]:1};return o},L=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},X=function(){if(f=e.offsetWidth,t.cover){s=innerHeight;var i=f/s;m>i?(x.width=Math.floor(i*g),x.height=g,x.offsetX=Math.floor((h-x.width)/2),x.offsetY=0):(x.height=Math.floor(h/i),x.width=h,x.offsetX=0,x.offsetY=Math.floor((g-x.height)/2))}else s=Math.floor(f/m);var r=innerHeight-s;d=s+r,n.width=f,n.height=s,n.style.top=Math.floor(r/2)+"px",o.style.height=d+"px",o.style.width=f+"px";var a=A();c=innerHeight*a,e.style.height=c+"px";var v=e.getBoundingClientRect();l=v.left,u=v.top+pageYOffset,p=v.bottom+pageYOffset-o.offsetHeight,R(),W(pageYOffset-u,!0)},B=function(){F()},F=function(){w||requestAnimationFrame(R),w=!0},R=function(){if(w=!1,v){var t=pageYOffset-u,e=pageYOffset-p;t>0&&0>e?(z(o,{position:"fixed",top:0,left:l+"px",bottom:"auto"}),W(t)):e>0?(z(o,{position:"absolute",top:"auto",left:0,bottom:0}),W(c)):0>t&&(z(o,{position:"absolute",top:0,left:0,bottom:"auto"}),W(0))}},W=function(e,o){var n=e/(c-d);n=Math.min(Math.max(n,0),1);var i=Math.floor(n*(t.count-1));(o||b!==i)&&(b=i,q(i))},q=function(e){i.clearRect(0,0,f,s);var o,n,a,c;t.cover?(o=x.offsetX,n=x.offsetY+g*e,a=x.width,c=x.height):(o=0,n=g*e,a=h,n=g),i.drawImage(r,o,n,a,c,0,0,f,s)},z=function(t,e){for(var o in e)t.style[o]=e[o]},A=function(){var e=10,o=2;return o+e*(1-t.speed)},j=function(t,e){var o=new Image;o.onload=function(){e(null,o)},o.onerror=function(){e("error loading image: "+t.src)},o.src=t.src},D=function(t){console&&console.error&&console.error("::flipbook:: "+t)};M()};return t});