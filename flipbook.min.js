!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.flipbook=t.call(this)}(function(){var t=function(t){var e,o,n,i,a,f,r,s,l,d,c,p,h,u,g,m,v,w={},b=-1,x=function(){var e,o=["id","path","extension","frames"];o.forEach(function(o){t[o]||(e=o)}),e?q("invalid options, missing "+e):(t.speed=parseFloat(t.speed)||.5,t.frames=parseInt(t.frames),t.path=t.path.trim(),t.path.lastIndexOf("/")!==t.path.length-1&&(t.path+="/"),y(),Y(),I(function(t){t?q(q):M()}))},M=function(){t.loaded&&"function"==typeof t.loaded&&t.loaded(),g=!0,E(),k(),B(0)},y=function(){e=document.getElementById(t.id),e.classList.add("flipbook-container"),o=document.createElement("div"),o.classList.add("flipbook-graphic"),e.appendChild(o),n=O(o),i=n.getContext("2d")},Y=function(){F(e,{position:"relative",width:"100%",overflow:"hidden"}),F(o,{position:"absolute",top:0,left:0}),F(n,{position:"absolute",top:0,left:0})},E=function(){window.addEventListener("resize",k,!1),window.addEventListener("scroll",H,!1)},I=function(e){m=[];for(var o=0;o<t.frames;o++)m[o]={src:t.path+(o+1)+"."+t.extension};var n=function(o){var i=m[o];W(i,function(a,f){a?e("error loading image"):(i.img=f,0===o&&(p=f.naturalWidth,h=f.naturalHeight,u=Math.round(p/h*1e3)/1e3),t.progress&&"function"==typeof t.progress&&t.progress({frame:o+1,total:t.frames,percent:Math.round(o/(t.frames-1)*100)}),o++,o<m.length?n(o):e())})};n(0)},O=function(t){var e=document.createElement("canvas");return e.classList.add("flipbook-canvas"),t.appendChild(e),e},k=function(){if(a=e.offsetWidth,t.cover){f=innerHeight;var i=a/f;u>i?(w.width=Math.floor(i*h),w.height=h,w.offsetX=Math.floor((p-w.width)/2),w.offsetY=0):(w.height=Math.floor(p/i),w.width=p,w.offsetX=0,w.offsetY=Math.floor((h-w.height)/2))}else f=Math.floor(a/u);var g=innerHeight-f;s=f+g,n.width=a,n.height=f,n.style.top=Math.floor(g/2)+"px",o.style.height=s+"px",o.style.width=a+"px";var m=R();r=innerHeight*m,e.style.height=r+"px";var v=e.getBoundingClientRect();l=v.left,d=v.top+pageYOffset,c=v.bottom+pageYOffset-o.offsetHeight,C(),X(pageYOffset-d,!0)},H=function(){L()},L=function(){v||requestAnimationFrame(C),v=!0},C=function(){if(v=!1,g){var t=pageYOffset-d,e=pageYOffset-c;t>0&&0>e?(F(o,{position:"fixed",top:0,left:l+"px",bottom:"auto"}),X(t)):e>0?(F(o,{position:"absolute",top:"auto",left:0,bottom:0}),X(r)):0>t&&(F(o,{position:"absolute",top:0,left:0,bottom:"auto"}),X(0))}},X=function(e,o){var n=e/(r-s);n=Math.min(Math.max(n,0),1);var i=Math.floor(n*(t.frames-1));(o||b!==i)&&(b=i,B(i))},B=function(e){i.clearRect(0,0,a,f),t.cover?i.drawImage(m[e].img,w.offsetX,w.offsetY,w.width,w.height,0,0,a,f):i.drawImage(m[e].img,0,0,a,f)},F=function(t,e){for(var o in e)t.style[o]=e[o]},R=function(){var e=10,o=2;return o+e*(1-t.speed)},W=function(t,e){var o=new Image;o.onload=function(){e(null,o)},o.onerror=function(){e("error loading image: "+t.src)},o.src=t.src},q=function(t){console&&console.error&&console.error("::flipbook:: "+t)};x()};return t});